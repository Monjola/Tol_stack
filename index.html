<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StackMaster | Tolerance Analysis</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>StackMaster · Tolerance Analysis</h1>
      <button id="open-settings-dialog" class="secondary">Settings</button>
    </header>

    <main>
      <section id="canvas-container">
        <h2>Visual Canvas</h2>
        <input type="file" id="drawing-upload" accept="image/*" />
        <div class="canvas-wrapper">
          <img id="drawing-img" alt="Drawing background" />
          <canvas id="drawing-canvas"></canvas>
        </div>
        <div class="canvas-controls">
          <span>Click = Balloon · Drag = Arrow</span>
          <button id="clear-annotations" class="secondary">Clear</button>
        </div>
      </section>

      <section id="data-grid">
        <h2>Stack Data</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th style="width: 40px;"></th>
                <th style="width: 60px;">Item Nr</th>
                <th style="width: 100px;">Part Nr</th>
                <th>Description</th>
                <th>Nominal</th>
                <th>Direction</th>
                <th class="advanced-col tolerance-type-col" style="display: none;">Tolerance Type</th>
                <th>Tol (+/-)</th>
                <th class="advanced-col cpk-col" style="display: none;">Cpk</th>
                <th class="advanced-col float-col" style="display: none;">Float Shifted</th>
                <th style="width: 60px;">Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="stack-body"></tbody>
          </table>
        </div>
        <div class="table-actions">
          <button id="add-row">Add Row</button>
        </div>
      </section>

      <section id="dashboard">
        <h2>Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-label">Stack Mean</span>
            <span class="stat-value" id="stat-mean">0.000</span>
          </div>
          <div class="stat-card basic-stat" id="stat-worst-case-card">
            <span class="stat-label">Worst Case</span>
            <span class="stat-value" id="stat-worst-case">±0.000</span>
          </div>
          <div class="stat-card basic-stat" id="stat-rss-card">
            <span class="stat-label">RSS</span>
            <span class="stat-value" id="stat-rss">±0.000</span>
          </div>
          <div class="stat-card advanced-stat" id="stat-sigma-card" style="display: none;">
            <span class="stat-label">Standard Deviation</span>
            <span class="stat-value" id="stat-sigma">±0.000</span>
          </div>
          <div class="stat-card advanced-stat" id="stat-3sigma-card" style="display: none;">
            <span class="stat-label">Process Range (3 standard deviations, Cpk=1)</span>
            <span class="stat-value" id="stat-3sigma">±0.000</span>
          </div>
          <div class="stat-card advanced-stat" id="stat-4sigma-card" style="display: none;">
            <span class="stat-label">4 standard deviations, Cpk=1.33</span>
            <span class="stat-value" id="stat-4sigma">±0.000</span>
          </div>
          <div class="stat-card advanced-stat" id="stat-5sigma-card" style="display: none;">
            <span class="stat-label">5 standard deviations, Cpk=1.67</span>
            <span class="stat-value" id="stat-5sigma">±0.000</span>
          </div>
          <div class="stat-card advanced-stat" id="stat-6sigma-card" style="display: none;">
            <span class="stat-label">+/-6 standard deviations, Cpk=2</span>
            <span class="stat-value" id="stat-6sigma">±0.000</span>
          </div>
        </div>
        <h3>Pareto Contributions</h3>
        <div class="pareto-info">
          <p class="pareto-explanation">
            The Pareto Principle (80/20 rule) states that roughly 80% of effects come from 20% of causes. 
            In tolerance analysis, this means a small number of dimensions typically contribute most to stack variation. 
            <strong>Focusing improvement efforts on the "vital few" dimensions will yield the greatest impact.</strong>
          </p>
        </div>
        <div id="pareto-chart"></div>
        <div class="pareto-legend"></div>
      </section>
    </main>

    <dialog id="settings-dialog">
      <form method="dialog">
        <h3>Settings</h3>
        <div class="settings-group">
          <h4>Advanced Features</h4>
          <label class="setting-toggle">
            <input type="checkbox" id="setting-advanced-statistical-mode" />
            <span>Advanced statistical mode using expected Cpk values</span>
          </label>
          <label class="setting-toggle">
            <input type="checkbox" id="setting-tolerance-type" />
            <span>Show Tolerance Type (Linear/GD&T/Float)</span>
          </label>
          <label class="setting-toggle">
            <input type="checkbox" id="setting-float-shifted" />
            <span>Show Float Shifted</span>
          </label>
        </div>
        <div class="table-actions">
          <button value="cancel" class="secondary">Close</button>
        </div>
      </form>
    </dialog>

    <dialog id="notes-dialog">
      <form method="dialog">
        <h3>Notes</h3>
        <label>
          <textarea id="notes-textarea" rows="8" placeholder="Enter notes here..."></textarea>
        </label>
        <div class="table-actions">
          <button type="button" id="notes-ok-btn">OK</button>
          <button value="cancel" class="secondary">Cancel</button>
        </div>
      </form>
    </dialog>

    <script type="module" src="js/main.js"></script>
  </body>
</html>

